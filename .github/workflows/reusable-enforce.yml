name: "Reusable Enforce Logic"

on:
  workflow_call: # <--- ISSO Ã‰ O QUE O TORNA GLOBAL

jobs:
  validate-checklist:
    name: Check Mandatory Items
    runs-on: ubuntu-latest
    steps:
      - name: Verify Checkboxes
        uses: actions/github-script@v6
        with:
          script: |
            // Acessa o payload do evento que disparou o workflow no projeto filho
            const { action } = context.payload;
            const body = context.payload.pull_request.body || "";
            
            // ðŸ›‘ REGRA 1: Fail Fast no Push
            if (action === 'synchronize') {
               core.setFailed("âŒ NOVO CÃ“DIGO DETECTADO: O Checklist foi invalidado. Aguarde o reset das caixas e marque-as novamente para liberar.");
               return;
            }

            // ðŸ›‘ REGRA 2: Verifica existÃªncia do Checklist
            const hasChecklist = body.includes("Checklist de Qualidade") || 
                                 body.includes("- [ ]") || 
                                 body.includes("- [x]");
            
            if (!hasChecklist) {
              core.setFailed("âŒ MERGE BLOQUEADO: O PR precisa conter o 'Checklist de Qualidade' na descriÃ§Ã£o.");
              return;
            }
            
            // ðŸ›‘ REGRA 3: Verifica caixas vazias
            if (body.includes("- [ ]")) {
              core.setFailed("âŒ MERGE BLOQUEADO: VocÃª precisa marcar todos os itens do 'Checklist de Qualidade'.");
            } else {
              console.log("âœ… Checklist completo. Liberado!");
            }